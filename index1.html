<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: #ffe6e6; 
            background-image: radial-gradient(#ffccd5 1px, transparent 1px);
            background-size: 20px 20px;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
        }

        /* --- PHASE 1: INTRO (M√ÄN H√åNH ƒêEN & NG√íI N·ªî) --- */
        #intro-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999; /* Lu√¥n n·∫±m tr√™n c√πng */
            display: flex;
            justify-content: center;
            align-items: flex-end; /* Ng√≤i n·ªï xu·∫•t ph√°t t·ª´ d∆∞·ªõi */
            transition: opacity 1s ease-out; /* Hi·ªáu ·ª©ng m·ªù d·∫ßn khi n·ªï xong */
        }

        .fuse-spark {
            width: 10px;
            height: 10px;
            background: #ff4500; /* M√†u cam l·ª≠a */
            border-radius: 50%;
            box-shadow: 0 0 10px #ff4500, 0 0 20px #ff8c00, 0 0 30px #ffd700;
            position: absolute;
            bottom: 0;
            /* Animation ch·∫°y t·ª´ d∆∞·ªõi l√™n gi·ªØa m√†n h√¨nh trong 4s */
            animation: burnFuse 4s linear forwards; 
        }

        /* Hi·ªáu ·ª©ng t√†n l·ª≠a r∆°i ra t·ª´ ng√≤i n·ªï */
        .fuse-spark::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: inherit;
            border-radius: inherit;
            animation: sparkFlicker 0.1s infinite;
        }

        @keyframes burnFuse {
            0% { bottom: 0; transform: translateX(0); }
            25% { transform: translateX(5px); } /* L·∫Øc nh·∫π cho gi·ªëng th·∫≠t */
            50% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { bottom: 50%; transform: translateX(0); } /* D·ª´ng ·ªü gi·ªØa */
        }

        @keyframes sparkFlicker {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- C√ÅC PH·∫¶N C≈® (H·ªòP QU√Ä, B√ÅNH KEM...) --- */
        #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .gift-container {
            position: absolute;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s;
            /* ·∫®n ƒëi ch·ªù intro xong m·ªõi hi·ªán */
            opacity: 0; 
            transform: scale(0);
        }
        
        /* Class ƒë·ªÉ hi·ªán h·ªôp qu√† sau khi n·ªï */
        .gift-container.show {
            opacity: 1;
            transform: scale(1);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .gift-container:hover { transform: scale(1.1) rotate(2deg); }

        .gift-box {
            font-size: 100px;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
            animation: shake 2s infinite;
        }

        .click-text {
            margin-top: 10px;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: #d6336c;
            font-weight: bold;
        }

        .card {
            display: none;
            position: relative;
            z-index: 5;
            width: 90%;
            max-width: 500px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            padding: 40px;
            text-align: center;
            opacity: 0;
            transform: translateY(50px) scale(0.9);
            border: 2px solid #fff0f3;
        }

        .card.open {
            display: block;
            animation: popup 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }

        /* CSS B√ÅNH KEM ƒê√É CƒÇN GI·ªÆA */
        .cake-container { position: relative; width: 150px; height: 150px; margin: 0 auto 20px; display: flex; justify-content: center; }
        .cake-body { width: 100%; height: 80%; background: #f4a460; border-radius: 10px; position: absolute; bottom: 0; box-shadow: inset 0 -10px 20px rgba(0,0,0,0.1); left: 0; }
        .cake-icing { width: 110%; height: 30%; background: #fff0f5; border-radius: 50%; position: absolute; top: 15%; left: -5%; box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .candle { width: 10px; height: 40px; background: #ffcccb; position: absolute; bottom: 85%; left: 50%; transform: translateX(-50%); border-radius: 5px; }
        .flame { width: 15px; height: 20px; background: orange; border-radius: 50%; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); animation: flicker 0.5s infinite alternate; }
        @keyframes flicker { 0% { transform: translateX(-50%) scale(1); opacity: 1; } 100% { transform: translateX(-50%) scale(0.9); opacity: 0.8; } }

        h1 { font-family: 'Dancing Script', cursive; color: #d6336c; font-size: 3rem; margin-bottom: 15px; line-height: 1.2; }
        p { font-size: 1.1rem; color: #555; line-height: 1.6; min-height: 100px; }
        .signature { margin-top: 30px; font-family: 'Dancing Script', cursive; font-size: 1.5rem; color: #d6336c; opacity: 0; animation: fadeIn 2s 3s forwards; }

        @keyframes shake { 0%, 100% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes popup { to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes fadeIn { to { opacity: 1; } }

    </style>
</head>
<body>

    <canvas id="canvas"></canvas>

    <audio id="fuseSound">
        <source src="https://www.soundjay.com/mechanical/sounds/fuse-burning-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="explosionSound">
        <source src="https://www.soundjay.com/mechanical/sounds/explosion-01.mp3" type="audio/mpeg">
    </audio>

    <div id="intro-layer" onclick="startFuse()">
        <div style="color: white; margin-bottom: 50px; font-family: 'Quicksand'; animation: blink 1s infinite;">
            Click v√†o m√†n h√¨nh ƒë·ªÉ b·∫Øt ƒë·∫ßu... üëá
        </div>
        <div class="fuse-spark" id="spark" style="display: none;"></div>
    </div>

    <div class="gift-container" id="giftContainer" onclick="openGift()">
        <div class="gift-box">üéÅ</div>
        <div class="click-text">M·ªôt m√≥n qu√† nh·ªè t·∫∑ng b√†!</div>
    </div>

    <div class="card" id="mainCard">
        <div class="cake-container">
            <div class="cake-body"></div>
            <div class="cake-icing"></div>
            <div class="candle"><div class="flame"></div></div>
        </div>
        <h1>Happy Birthday! üéÇ</h1>
        <p id="typingContent"></p>
        <div class="signature">From [T√™n Bro] with ‚ù§Ô∏è</div>
    </div>

    <script>
        // --- CONFIG ---
        const config = {
            message: "Ch√∫c m·ª´ng sinh nh·∫≠t nh√©! Ch√∫c b√† tu·ªïi m·ªõi lu√¥n xinh ƒë·∫πp, r·∫°ng r·ª° v√† ƒë·∫°t ƒë∆∞·ª£c m·ªçi mong ∆∞·ªõc. H√£y lu√¥n vui v·∫ª nh∆∞ th·∫ø n√†y nh√©! ‚ú®",
            typingSpeed: 50
        };

        // --- DOM ELEMENTS ---
        const introLayer = document.getElementById('intro-layer');
        const spark = document.getElementById('spark');
        const giftContainer = document.getElementById('giftContainer');
        const mainCard = document.getElementById('mainCard');
        
        // --- SOUNDS (ƒê√£ b·ªè nh·∫°c n·ªÅn) ---
        const fuseSound = document.getElementById('fuseSound');
        const explosionSound = document.getElementById('explosionSound');

        // --- STEP 1: B·∫ÆT ƒê·∫¶U CH·∫†Y NG√íI N·ªî (Khi click v√†o m√†n h√¨nh ƒëen) ---
        function startFuse() {
            // X√≥a d√≤ng ch·ªØ h∆∞·ªõng d·∫´n click
            introLayer.querySelector('div').style.display = 'none';
            // Hi·ªán ƒë·ªëm l·ª≠a
            spark.style.display = 'block';
            
            // Ph√°t ti·∫øng x√¨ x√®o
            fuseSound.play().catch(e => console.log("Audio play failed"));

            // L·∫Øng nghe khi animation ch·∫°y xong (4s sau)
            spark.addEventListener('animationend', () => {
                triggerExplosion();
            });
        }

        // --- STEP 2: N·ªî TUNG & HI·ªÜN QU√Ä ---
        function triggerExplosion() {
            fuseSound.pause(); // T·∫Øt ti·∫øng x√¨ x√®o
            explosionSound.play(); // B·∫≠t ti·∫øng n·ªï B√ôM

            // Hi·ªáu ·ª©ng ph√°o hoa c·ª±c m·∫°nh (Canvas Confetti)
            confetti({
                particleCount: 150,
                spread: 100,
                origin: { y: 0.6 }, // N·ªï ·ªü gi·ªØa m√†n h√¨nh
                colors: ['#ff0000', '#ffa500', '#ffff00', '#ffffff'],
                zIndex: 10000
            });

            // ·∫®n m√†n h√¨nh ƒëen
            introLayer.style.opacity = '0';
            setTimeout(() => {
                introLayer.style.display = 'none'; // X√≥a h·∫≥n kh·ªèi DOM
                
                // Hi·ªán h·ªôp qu√† ra
                giftContainer.classList.add('show');
            }, 500); // ƒê·ª£i 0.5s ƒë·ªÉ hi·ªáu ·ª©ng n·ªï hi·ªán ra ch√∫t ƒë√£
        }

        // --- STEP 3: M·ªû QU√Ä (TH√äM PH√ÅO HOA) ---
        function openGift() {
            giftContainer.style.display = 'none';
            mainCard.classList.add('open');

            // B·∫Øn ph√°o gi·∫•y ch√∫c m·ª´ng (Phase 4)
            fireConfetti(); 
            setTimeout(fireConfetti, 300); // B·ªìi th√™m ph√°t n·ªØa

            initParticles(); // Tim bay (hi·ªáu ·ª©ng c≈©)
            typeWriter(config.message, document.getElementById('typingContent'));
        }

        // --- C√ÅC H√ÄM PH·ª§ TR·ª¢ (Gi·ªØ nguy√™n) ---
        function fireConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var randomInRange = (min, max) => Math.random() * (max - min) + min;
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
            }, 250);
        }

        function typeWriter(text, element) {
            let i = 0;
            element.innerHTML = "";
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, config.typingSpeed);
                }
            }
            type();
        }

        // Animation Tim bay (Canvas)
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class Particle {
            constructor() {
                this.x = Math.random() * width; this.y = height + Math.random() * 100;
                this.velY = Math.random() * -3 - 1; this.velX = Math.random() * 2 - 1;
                this.size = Math.random() * 15 + 10; this.color = `hsl(${Math.random() * 60 + 330}, 100%, 70%)`;
                this.rotation = Math.random() * Math.PI * 2;
            }
            update() {
                this.y += this.velY; this.x += Math.sin(this.y / 50) * 1; this.rotation += 0.05;
                if (this.y < -50) { this.y = height + 50; this.x = Math.random() * width; }
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rotation);
                ctx.beginPath(); ctx.fillStyle = this.color;
                const h = this.size * 0.3;
                ctx.moveTo(0, h); ctx.bezierCurveTo(0,0,-this.size/2,0,-this.size/2,h);
                ctx.bezierCurveTo(-this.size/2,(this.size+h)/2,0,this.size,0,this.size);
                ctx.bezierCurveTo(0,this.size,this.size/2,(this.size+h)/2,this.size/2,h);
                ctx.bezierCurveTo(this.size/2,0,0,0,0,h);
                ctx.fill(); ctx.closePath(); ctx.restore();
            }
        }
        function initParticles() { for(let i=0; i<50; i++) particles.push(new Particle()); animate(); }
        function animate() { ctx.clearRect(0, 0, width, height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animate); }
    </script>
</body>
</html>